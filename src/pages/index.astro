---
import { siteConfig } from '../config/site';

// Improved language detection function
function getBrowserLanguage(acceptLanguage: string | null): 'en' | 'pl' {
  console.log(acceptLanguage);
  if (!acceptLanguage) return 'en';
  
  // Parse the Accept-Language header properly
  const languages = acceptLanguage.split(',')
    .map(lang => {
      const [language, weight] = lang.trim().split(';');
      return {
        language: language.split('-')[0], // Get base language code
        weight: weight ? parseFloat(weight.split('=')[1]) : 1
      };
    })
    .sort((a, b) => b.weight - a.weight);
  console.log(languages);
  // Check if Polish is one of the preferred languages
  const prefersPL = languages.some(lang => lang.language === 'pl');
  
  return prefersPL ? 'pl' : 'en';
}

// Server-side redirect
const acceptLanguage = Astro.request.headers.get('accept-language');
const detectedLang = getBrowserLanguage(acceptLanguage);

// Perform immediate redirect
return Astro.redirect(`/${detectedLang}/`, 307);
---